---

- hosts: all
  vars_files:
    - "../configurations/{{ inventory_hostname }}.context.yaml"
  pre_tasks:
    - name: check only one ingress controller is enabled
      meta: end_play
      when: components.ingress.nginx and components.ingress.traefik
  roles:
    - role: ingress/nginx
      when: components.ingress.nginx
    - role: ingress/traefik
      when: components.ingress.traefik
    - role: security/certmanager
      when: components.security.certmanager
    - role: datastore/postgresql
      when: components.datastore.postgresql
    - role: administration/pgadmin
      when: components.administration.pgadmin
    - role: datastore/redis
      when: components.datastore.redis
    - role: monitoring/prometheus
      when: components.monitoring.prometheus
    - role: monitoring/grafana
      when: components.monitoring.grafana
    - role: messaging/nats
      when: components.messaging.nats
    - role: messaging/rabbitmq
      when: components.messaging.rabbitmq
    - role: communication/wiki
      when: components.communication.wiki
    - role: administration/dashboard
      when: components.administration.dashboard
    - role: automation/rundeck
      when: components.automation.rundeck
